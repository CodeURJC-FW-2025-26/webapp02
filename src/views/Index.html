<!DOCTYPE html>

{{> partials/header}}

<main>
     <!-- Banner with search bar and add button -->
     <section class="banner">
          <!-- Search Form -->
          <div class="search-container">
               <form action="/" method="GET" role="search">
                    <input type="text" name="search" placeholder="Buscar una receta por nombre..."
                         value="{{searchQuery}}">
               </form>
          </div>
          <!-- Recipe section title and action button -->
          <div class="banner-content">
               <h2 class="banner-title">RECETAS RECOMENDADAS</h2>
               <a class="btn btn-dark" href="/receta/nueva">Añadir receta</a>
          </div>
     </section>

     <!-- Category Filter Buttons -->
     <section class="category-buttons">
          <a href="/" class="{{#categoryStates.all}}active{{/categoryStates.all}}">Todas</a>
          <a href="/?category=entrante"
               class="{{#categoryStates.entrante}}active{{/categoryStates.entrante}}">Entrantes</a>
          <a href="/?category=principal" class="{{#categoryStates.principal}}active{{/categoryStates.principal}}">Platos
               Principales</a>
          <a href="/?category=postre" class="{{#categoryStates.postre}}active{{/categoryStates.postre}}">Postres</a>
          <a href="/?category=vegano" class="{{#categoryStates.vegano}}active{{/categoryStates.vegano}}">Veganos</a>
     </section>

     <!-- Recommended recipes grid -->
     <section class="container">
          <!-- Modified: Added ID 'recipe-grid' for Infinite Scroll JS targeting -->
          <div class="row" id="recipe-grid">
               {{#recipes}}
               <!-- Loop: This will repeat for each recipe in the 'recipes' array -->
               <!-- Modified: Added class 'recipe-card-container' for consistency with dynamically created cards -->
               <div class="col-12 col-sm-6 col-lg-4 recipe-card-container">
                    <a href='/receta/{{_id}}'><img src="/uploads/{{image}}" alt="{{name}}"></a>
                    <h3>{{name}}</h3>
               </div>
               {{/recipes}}

               {{^recipes}}
               <!-- This is shown if the 'recipes' array is empty -->
               <div class="col-12 text-center my-5">
                    <h3>No se encontraron recetas que coincidan con tu búsqueda.</h3>
               </div>
               {{/recipes}}
          </div>

          <!-- NEW: Spinner for Infinite Scroll (Hidden by default with d-none) -->
          <div id="scroll-spinner" class="text-center my-4 d-none">
               <div class="spinner-border text-dark" role="status">
                    <span class="visually-hidden">Cargando más recetas...</span>
               </div>
          </div>
     </section>

     <!-- Pagination -->
     <!-- We only show pagination if there are recipes -->
     {{#recipes.length}} {{! Solo mostramos la paginación si el array de recetas no está vacío }}
     <!-- Modified: Added 'd-none' class to hide manual pagination as we are using Infinite Scroll -->
     <nav aria-label="Paginación de recetas" class="d-flex justify-content-center mb-5 d-none">
          <ul class="pagination">

               <!-- "Anterior" Button -->
               {{#hasPrevPage}}
               <li class="page-item">
                    <a class="page-link" href="/?page={{prevPage}}&search={{searchQuery}}&category={{categoryQuery}}"
                         aria-label="Anterior">
                         <span aria-hidden="true">&laquo;</span>
                    </a>
               </li>
               {{/hasPrevPage}}
               {{^hasPrevPage}}
               <li class="page-item disabled">
                    <a class="page-link" href="#" tabindex="-1" aria-disabled="true" aria-label="Anterior">
                         <span aria-hidden="true">&laquo;</span>
                    </a>
               </li>
               {{/hasPrevPage}}

               <!-- Numeric Page Buttons (dynamically generated) -->
               {{#pagesForTemplate}}
               {{^isEllipsis}}
               <li class="page-item {{#isCurrent}}active{{/isCurrent}}">
                    <a class="page-link"
                         href="/?page={{page}}&search={{searchQuery}}&category={{categoryQuery}}">{{page}}</a>
               </li>
               {{/isEllipsis}}
               {{#isEllipsis}}
               <li class="page-item disabled"><span class="page-link">...</span></li>
               {{/isEllipsis}}
               {{/pagesForTemplate}}


               <!-- "Siguiente" Button -->
               {{#hasNextPage}}
               <li class="page-item">
                    <a class="page-link" href="/?page={{nextPage}}&search={{searchQuery}}&category={{categoryQuery}}"
                         aria-label="Siguiente">
                         <span aria-hidden="true">&raquo;</span>
                    </a>
               </li>
               {{/hasNextPage}}
               {{^hasNextPage}}
               <li class="page-item disabled">
                    <a class="page-link" href="#" tabindex="-1" aria-disabled="true" aria-label="Siguiente">
                         <span aria-hidden="true">&raquo;</span>
                    </a>
               </li>
               {{/hasNextPage}}
          </ul>
     </nav>
     {{/recipes.length}}

     <!-- NEW: Hidden inputs to store state for Infinite Scroll JS -->
     <input type="hidden" id="initial-search" value="{{searchQuery}}">
     <input type="hidden" id="initial-category" value="{{categoryQuery}}">
     <input type="hidden" id="next-page" value="{{initialNextPage}}">

</main>

{{> partials/footer}}

</html>