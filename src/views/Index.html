<!-- webapp02/src/views/Index.html */ -->

<!DOCTYPE html>

{{> partials/header}}

<main>
     <!-- Banner with search bar and add button -->
     <section class="banner">
          <!-- Search Form -->
          <div class="search-container">
               <form action="/" method="GET" role="search">
                    <input type="text" name="search" placeholder="Buscar una receta por nombre..."
                         value="{{searchQuery}}">
               </form>
          </div>
          <!-- Recipe section title and action button -->
          <div class="banner-content">
               <h2 class="banner-title">RECETAS RECOMENDADAS</h2>
               <a class="btn btn-dark" href="/receta/nueva">Añadir receta</a>
          </div>
     </section>

     <!-- Category Filter Buttons -->
     <section class="category-buttons">
          <a href="/" class="{{#categoryStates.all}}active{{/categoryStates.all}}">Todas</a>
          <a href="/?category=entrante"
               class="{{#categoryStates.entrante}}active{{/categoryStates.entrante}}">Entrantes</a>
          <a href="/?category=principal" class="{{#categoryStates.principal}}active{{/categoryStates.principal}}">Platos
               Principales</a>
          <a href="/?category=postre" class="{{#categoryStates.postre}}active{{/categoryStates.postre}}">Postres</a>
          <a href="/?category=vegano" class="{{#categoryStates.vegano}}active{{/categoryStates.vegano}}">Veganos</a>
     </section>

     <!-- Recommended recipes grid -->
     <section class="container">
          <!-- Modified: Added ID 'recipe-grid' for Infinite Scroll JS targeting -->
          <div class="row" id="recipe-grid">
               {{#recipes}}
               <!-- Loop: This will repeat for each recipe in the 'recipes' array -->
               <!-- Modified: Added class 'recipe-card-container' for consistency with dynamically created cards -->
               <div class="col-12 col-sm-6 col-lg-4 recipe-card-container mb-4">

                    <div class="flip-card">
                         <div class="flip-card-inner">

                              <div class="flip-card-front">
                                   <img src="/uploads/{{image}}" alt="{{name}}"
                                        class="img-fluid h-100 w-100 object-fit-cover rounded">
                                   <div class="card-gradient-overlay"></div>
                                   <h3 class="card-front-title">{{name}}</h3>
                              </div>

                              <div class="flip-card-back">
                                   <h3>{{name}}</h3>
                                   <p class="recipe-short-desc">{{description}}</p>
                                   <a href="/receta/{{_id}}" class="btn btn-visual">Ver Receta Completa</a>
                              </div>
                         </div>
                    </div>

               </div>
               {{/recipes}}

               {{^recipes}}
               <!-- This is shown if the 'recipes' array is empty -->
               <div class="col-12 text-center my-5">
                    <h3>No se encontraron recetas que coincidan con tu búsqueda.</h3>
               </div>
               {{/recipes}}
          </div>

          <!-- NEW: Spinner for Infinite Scroll (Hidden by default with d-none) -->
          <div id="scroll-spinner" class="text-center my-4 d-none">
               <div class="spinner-border text-dark" role="status">
                    <span class="visually-hidden">Cargando más recetas...</span>
               </div>
          </div>
     </section>

     <!-- NEW: Hidden inputs to store state for Infinite Scroll JS -->
     <input type="hidden" id="initial-search" value="{{searchQuery}}">
     <input type="hidden" id="initial-category" value="{{categoryQuery}}">
     <input type="hidden" id="next-page" value="{{initialNextPage}}">

</main>

{{> partials/footer}}

</html>